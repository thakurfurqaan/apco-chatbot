<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crop Disease Advisor</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body, html {
        height: 100vh;
        margin: 0;
        font-family: 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
        background-color: #24252d;
        color: #343541;
        padding: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .chat-container {
        max-height: 100%;
        display: flex;
        flex-direction: column;
        margin: 0 auto;
        background-color: white;
        border-radius: 10px;
      }
      .chat-header {
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid #e5e5e5;
      }
      .chat-messages {
        flex-grow: 1;
        overflow-y: auto;
        padding: 20px;
      }
      .message {
        margin-bottom: 20px;
        padding: 20px;
        border-radius: 20px;
        max-width: 80%;
      }
      .user-message {
        background-color: #24252d;
        align-self: flex-end;
        margin-left: auto;
        color: white;
      }
      .bot-message {
        background-color: #ffffff;
        align-self: flex-start;
        border: 1px solid #e5e5e5;
      }
      .chat-input {
        padding: 20px;
        border-top: 1px solid #e5e5e5;
      }
      .btn-custom {
        background-color: #10a37f;
        border: none;
        color: white;
      }
      .btn-custom:hover {
        background-color: #1a7f64;
      }
      #sync-products {
      
      }
      #chat-parent {
        height: 100%;
        width: 100%;
        background-color: red;
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">
        <div class="container" >
          <div class="row justify-content-between align-items-center">
            <div class="col-auto">
              <h1>Crop Disease Advisor</h1>
            </div>
            <div class="col-auto">
              <button id="sync-products" class="btn btn-outline-secondary">Sync Products</button>
            </div>
          </div>
        </div>
      </div>
        <div id="chat-messages" class="chat-messages">
          <!-- Chat messages will be displayed here -->
        </div>
      
        <div class="chat-input">
            <form id="chat-form" class="mb-3">
            <div class="input-group">
                <input
                type="text"
                id="user-input"
                class="form-control"
                placeholder="Ask about crops, soil, diseases, pests, or products..."
                value="I need a product to control fungal diseases in my wheat crop"
                />
                <button class="btn btn-custom" type="submit">Send</button>
            </div>
            </form>
        </div>
    </div>
    
  </body>
</html>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const chatForm = document.getElementById("chat-form");
      const userInput = document.getElementById("user-input");
      const chatMessages = document.getElementById("chat-messages");
      const imageUploadForm = document.getElementById("image-upload-form");
      const syncProductsButton = document.getElementById("sync-products");

      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (message) {
          appendMessage("You", message, "user-message");
          userInput.value = "";
          const response = await sendMessage(message);
          appendMessage("Bot", response.message, "bot-message");
        }
      });

      syncProductsButton.addEventListener("click", async () => {
        try {
          const response = await fetch("/products/sync", { method: "POST" });
          const result = await response.json();
          alert(result.message);
        } catch (error) {
          alert("Error syncing products");
        }
      });

      async function sendMessage(message) {
        const response = await fetch("/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ message }),
        });
        return response.json();
      }

      function appendMessage(sender, message, className) {
        const messageElement = document.createElement("div");
        messageElement.className = `message ${className}`;
        messageElement.innerHTML = `<pre style="white-space: pre-wrap; overflow: hidden;">${formatToHTML(message)}</pre>`;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function formatToHTML(text) {
        text = text.replace(/^###\s*(.*$)/gm, '<h3>$1</h3>');
        text = text.replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>');
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
        text = text.replace(/\n/g, '<br>');
        return text;
    }

      appendMessage("You", "Okay", "user-message")
      appendMessage("AgriTech", "Fungal diseases in wheat crops can manifest as various symptoms, including yellowing leaves, lesions on stems and leaves, and premature leaf drop. Common fungal diseases affecting wheat include Fusarium head blight, Septoria leaf blotch, and rust diseases. These diseases can significantly reduce yield and quality if not managed properly.\n\n**Recommendation 1:** \n- **Product Name:** FungaShield\n- **Description:** FungaShield is a broad-spectrum fungicide designed to protect a variety of crops, including wheat, from fungal infections.\n- **Key Benefits:**\n  • Provides comprehensive protection against a wide range of fungal diseases.\n  • Helps to improve crop health and yield by preventing disease establishment.\n  • Easy to apply, compatible with most other crop protection products.\n- **Usage:** Apply FungaShield at the first sign of disease or as a preventive measure during critical growth stages. Follow label instructions for dosage and application timing.\n\n**Recommendation 2:** \n- **Product Name:** RootGuard\n- **Description:** RootGuard is a systemic fungicide that helps prevent root diseases in crops, ensuring that plants remain healthy from the ground up.\n- **Key Benefits:**\n  • Offers long-lasting protection by being absorbed into the plant system.\n  • Effective against root rot pathogens, which can compromise plant health.\n  • Enhances nutrient uptake and overall vigor of the wheat plants.\n- **Usage:** Apply RootGuard during planting or at the early growth stages to protect root systems. Follow the recommended application rates on the label.\n\n**Recommendation 3:** \n- **Product Name:** SeedShield\n- **Description:** SeedShield is a seed treatment product designed to protect against soil-borne pathogens during the critical early stages of crop establishment.\n- **Key Benefits:**\n  • Provides early protection against diseases that can affect germination and seedling health.\n  • Promotes stronger crop establishment and improved survival rates.\n  • Reduces the need for additional fungicide applications later in the season.\n- **Usage:** Treat seeds with SeedShield before planting, following the manufacturer's guidelines for treatment rates and methods. \n\nThese recommendations should help you effectively manage fungal diseases in your wheat crop. Always ensure to follow local regulations and safety guidelines when applying any agricultural products.", "bot-message");
    </script>
  </body>
</html>
